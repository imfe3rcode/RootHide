### Автор гайда: [fe3rcode](https://t.me/fe3rcode)
*Редактор: [mrvokintos](https://t.me/mr_vokintos)*

#### ПЕРЕД ПРОЧТЕНИЕМ

Я пользуюсь системой на английском (и вам советую), поэтому во время настройки у тебя могут возникнуть проблемы. Рекомендую хотя бы на время установки и настройки поставить английский как системный язык.

# 1. Выбор рут менеджера

Большая половина юзеров, к счастью, уже забыла про Magisk и его форки. Это правильное решение, т.к. несмотря на свою популярность, этот рут менеджер имеет тонну трейсов (остатков в системе), устаревший метод монтирования модулей и еще много, много минусов, по сравнению с современными решениями.

Все популярные менеджеры, не считая APatch и его форки, строятся на базе KernelSU. Его форков существует бесконечное количество, и каждый форк по-своему уникален. Это обусловленно множеством факторов, от технической базы до UI/UX.

В этом гайде я буду рассматривать только KernelSU Next (далее KSUN), так как этим менеджером пользуются мои знакомые, занимающиеся сборкой кастомных ядер Android.

Ключевые отличия KSUN - частота выхода новых обновлений, активная поддержка от сообщества и большое количество пользователей, готовых помочь с проблемами и ошибками.

В этот раз будем устанавливать KSUN в LKM режиме (на уровне модуля ядра), а не GKI (на уровне драйвера), так как этот метод является более универсальным и стабильным для мобильных устройств (по словам автора KSU, сам я разницы не вижу)

# 2. Краткиий курс по установке
## 2.0.1. Небольное предисловие
Тут стоит остановиться на секунду. Для всех девайсов установка производится одинаково, но для девайсов Google Pixel я крайне рекомендую скачивать AK3 образ c WildKSU (форк KSUN) из [репозитория моего знакомого](https://github.com/wmorty/miumiu-wksu-susfs2). Эти образы содержат в себе крайне важные оптимизационные твики для девайсов с процессором Tensor G2-G4. После загрузки необходимого AK3 образа, шаги для установки абсолютное те же самые, что и для любого устройства

## 2.1. Непосредственно установка
### 2.1.1. Установка LKM
Итак, первый шаг в этом деле - загрузка и извлечение образа ядра твоей прошивки. На большинстве девайсов это делается просто: открываешь любой поисковик, будь то гугл или яндекс, и конструируешь следующий поисковый запрос по шаблону:

[Полное название модели телефона] stock rom

Например, 
Xiaomi Redmi Note 14 Pro 5G stock rom

Далее ищи конкретно ту версию прошивки, которая стоит у тебя. Посмотреть это можно в настройках телефона. Строка может называться по-разному (Build number / Firmware version), суть одна.

### ВАЖНО!
Необходимо скачать именно полный образ прошивки, а не OTA или GSI (если, конечно, у тебя нет желания повозиться с извлечением образов из payload'а)

Скачав ту же версию прошивки, что стоит сейчас, на свой пк, открывай её через любой архиватор (WinRAR, 7zip) и ищи внутри файл init-boot.img (boot.img, если ramdisk находится там и/или у вас есть только init.img; или init'а вообще нет в прошивке, что бывает крайне редко)

Данный файл необходимо любым способом перенести в удобное место на своем телефоне/планшете.

После этого, переходим в [телеграм-группу со сборками app-менеджера KSUN](https://t.me/ksunext_ci) и устанавливаем последний стабильный релиз менеджера. Заходим и патчим наш образ init-boot.img в менеджере. На выходе получим файл в /sdcard/Download/, который смело отправляем на пк.

Теперь самая трудная часть для пользователей китайских телефонов (в частности xiaomi): прошивка ядра. Процесс разблокировки загрузчика обьяснять не буду, т.к. на каждый девайс это делается по-своему (спасибо нашим китайским братьям, нам же так не хватало MI Unlock с кулдауном 70-170 часов для разблокировки). Вкратце, гуглишь, как прошить ядро на своем девайсе и смотришь/читаешь гайды (рекомендую искать на форумах, в текстовом формате).

Универсальная комманда для прошивки ядра на всех нормальных и околонормальных девайсах:
```
fastboot flash boot PATCHED.img
```
где *PATCHED.img* - это файл, который ты в последний раз перенес на свой пк.

### 2.1.2. Установка GKI
**Внимание!**
***Пропускайте этот пункт, если вы не знаете, что это такое, или не являетесь разработчиком***

Возможно, раньше вы уже использовали build-in GKI драйвер KSU, т.к. это обусловлено бывшей актуальностью SUSFS, но после релиза KSU v3.0.0 этот костыльный модуль потерял популярность, а для повседневного использования оказался вреден

Подробнее про это можно почитать [здесь](/gki-susfs.md)

# 2.3. Модули
Теперь, когда ты установил рут, самое время установить все необходимые модули

Быстро пройдемся по тому, что будем устанавливать:
- [Zygisk Next](https://github.com/Dr-TSNG/ZygiskNext) - самостоятельная реализация Zygisk, нужна для работы модулей, использующих Zygisk API
- [PlayIntegrity Fix](https://github.com/KOWX712/PlayIntegrityFix) - исправление аттестации PlayIntegrity. Необходим для работы Google Pay и большинства банковских приложений в СНГ и Европе
- [TrickyStore](https://github.com/5ec1cff/TrickyStore) - обход Keystore и скрытие статуса загрузчика. Требуется для Google Pay и прочих сервисов, требующих STRONG аттестацию PlayIntegrity
- [TrickyAddon](https://github.com/KOWX712/Tricky-Addon-Update-Target-List) - дополнение для TrickyStore. Добавляет WebUI (веб-интерфейс в рут-менеджере) для удобной и быстрой настройки
- [LSPosed](https://t.me/LSP_Leaks) - вспомогательный модуль. Открывает огромные возможности, всех не перечислить
- [HMA-OSS](https://github.com/frknkrc44/HMA-OSS) - LSPosed-модуль для скрытия наличия установленных приложений от других игр/приложений

Эти модули являются базой уже на протяжении долгого времени (примерно такой же список я использовал в первой редакции гайда).

Последовательность установки следующая (не уверен, что это влияет на что-то, но я всегда устанавливаю так):
1. Zygisk Next (без него другие модули не будут работать/даже не установятся)
2. PlayIntegrityFix
3. TrickyStore
4. TrickyAddon
5. Перезагрузка
6. LSPosed
7. HMA-OSS
8. Перезагрузка

# 2.4. Настройка модулей
Если ты смог выполнить все, что описано выше, то ты человек не глупый, а значит найти необходимые настройки сможешь сам. Я оставлю лишь несколько скриншотов, которые наведут на верные мысли:

<div style="display: flex; justify-content: space-between;">
  <img src="/assets/photo1.jpg" width="24%">
  <img src="/assets/photo2.jpg" width="24%">
</div>

<div style="display: flex; justify-content: space-between;">
  <img src="/assets/photo3.jpg" width="24%">
  <img src="/assets/photo4.jpg" width="24%">
  <img src="/assets/photo5.jpg" width="24%">
</div>
<br><br>

После верной настройки имеем полностью скрытый рут:
<div style="display: flex; justify-content: space-between;">
  <img src="/assets/clip2.png" width="24%">
</div>

# 3. Конец
Благодарю за прочтение этого гайда. Я надеюсь, для кого-то он окажется полезным и поможет не попасть на бабки
<div style="display: flex; justify-content: space-between;">
  <img src="/assets/clip3.png" width="24%">
</div>
<br>

Поддержать автора гайда и задать вопрос: в телеграме [fe3rcode](https://t.me/fe3rcode)

Также помощь можно получить у крутого чувака с никнеймом [mrvokintos](https://t.me/mr_vokintos)

**Очень прошу тебя не спрашивать очевидные вещи, которые может помочь решить гугл/яндекс/любая нейронка.** **Перед тем, как задавать вопрос, пожалуйста, хотя бы постарайся найти ответ в интернете. Я могу быть агрессивным, когда мне задают очевидные вопросы.**
