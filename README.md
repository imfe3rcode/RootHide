### Целью данного гайда является развеивание мифов, связанных со скрытием рут прав

##### Автор: fe3rcode
##### ПЕРЕД ПРОЧТЕНИЕМ
Я пользуюсь системой на английском (и вам советую), поэтому во время настройки у тебя могут возникнуть проблемы. Рекомендую хотя бы на время установки и настройки поставить английский как системный язык.

# Часть первая. Выбор root-менеджера

Несмотря на то, что все долгое время пользовались сначала Magisk, а потом его модификациями (Magisk Delta (Kitsune), Magisk Alpha, etc.), пора признать тот факт, что в нашем сообществе этот менеджер является устаревшим. Magisk Delta не обновляется, не имеет поддержки WebView (которые важны для настройки современных модулей (связанных не только со скрытием)), а Magisk Alpha практически не имеет отличий от оригинального Magisk.

Выбор стоит между APatch, KernelSU (KSU) и KernelSU Next (KSUN) (не рассматриваем творение meowna, которое является пастой KSUN).

#### Рассмотрим первый вариант - Apatch:
1. Основан на KernelPatch
2. Имеет нативную поддержку магископодобных модулей
3. Имеет поддержку модулей, которые позволяют внедрять (инжектить) любой код в ядро (предоставляет функции ядра inline-hook и syscall-table-hook)
4. Root-доступ настраивается отдельно для каждого приложения
5. Имеет самую широкую поддержку (ядра Linux от 3.18 до 6.1)
6. Поддерживает только arm64
**Данный вариант подойдёт только для тех, чей девайс не поддерживает последующие варианты.**
Из минусов выделяется отсутствие поддержки SuSFS (о нём ниже).

#### Второй вариант - KernelSU:
1. Доступ к su, базированный на патче ядра
2. Система модулей, основанная на OverlayFS
3. Поддерживает LKM (4.14+) и GKI 2.0 (5.10+) ядра
4. Поддерживает arm64 и x86_64 (последнее не проверял)
**Этот вариант уже лучше предыдущего, так как поддерживает SuSFS, но при этом не поддерживает устаревшие по моему мнению ядра.**

#### Третий вариант - KernelSU Next
1. Основан на проекте KSU
2. Помимо OverlayFS, имеет поддержу Magic Mount
3. Имеет более широкую поддержку в сравнении с KSU
4. На момент выпуска гайда (24.04.25), поддерживает только arm64
Вкратце о поддержке:
	- GKI 2.0 (5.10+)
	- GKI 1.0 (4.19 - 5.4)
	- EOL/LKM (<4.14) - требует ручной сборки ядра из исходников с использованием драйвера KSUN
Несмотря на то, что сейчас поддерживается только arm64, разработчик подтвердил, что готовится к выпуску x86_64 версии, но только для Windows Subsystem for Android (WSA)
**Имеет поддержку SuSFS.**

Итак, с вариантами ознакомились, теперь непосредственно к выбору.
#### Так какой менеджер в итоге выбрать?
Если твое ядро поддерживает GKI 2.0 (ядра 5.10+), то выбрать стоит именно KSUN. Он полностью совместим с магиск модулями, активно развивается и регулярно обновляется, принося новые плюшки.

Если твое ядро поддерживает только LKM или GKI 1.0, то KSUN тоже сойдет, но не может быть скрыт в той же мере, что KSUN, установленный на GKI 2.0 ядра.

В крайнем случае (такое вообще бывает в 2025?), если твое ядро версии 3.18 - 4.14, придется ставить APatch.

С менеджером определились, качаем последний стабильный билд с Github.
## Что такое SuSFS?

SuSFS - это аддон для ядра Linux, добавляющий патчи для скрытия рута. Требует модуля susfs4ksu для настройки патчей.

## Краткий тутор на установку KSUN + SuSFS (GKI 2.0)

1. Переходим по ссылке (https://github.com/WildPlusKernel/GKI_KernelSU_SUSFS)
2. Узнаем формат boot.img по гайду в Readme.md
3. Скачиваем boot.img для своего девайса во вкладке Releases
4. Прошиваем в активный слот boot/_a/_b
5. В менеджере KSU/KSUN видим версию установленного SuSFS

#### ВАЖНО!!!
Если после прошивки бута ты словил бутлуп, выбери одно из двух:
1. Прошить стоковый бут, сделать бэкап всех важных файлов, прошить новый бут с гитхаба и сделать factory reset
2. Сделать factory reset без бэкапа

## Модули для скрытия или притча о PlayIntegrity
Большинство юзеров использует кучу модулей, которые не используют или установили потому, что "кто-то сказал, что оно скрывает рут".
Я считаю, что умный пользователь следит за своим девайсом так же, как и за собственным телом/домом. Ты же не срешь там, где спишь и регулярно моешься, верно, задрот?

### Список моих модулей:
Все эти модули я использую лично на своем основном девайсе (Google Pixel 6a)
1. susfs4ksu (для настройки SuSFS)
2. PlayIntegrityFix (от chiteroman)
3. TrickyStore
4. TrickyAddon (для углублённой настройки TrickyStore)
5. Zygisk Next (от 5ec1cff и Nullptr)
6. Zygisk LSPosed (кастомный на основе JingMatrix'a)
7. (НЕ ДЛЯ СКРЫТИЯ) PixelXpert (для кастомизации Google Pixel)
#### Что такое PlayIntegrity?
PlayIntegrity - это встроенная в некоторые приложения от Google (GooglePlay Services/framework/Google Wallet) проверка целостности компонентов. После прошивки эта целостность нарушается, поэтому оплата через Google Pay невозможна (без модификаций).

### Что такое PlayIntegrityFix?
PlayintegrityFix (дальше PIF) - это модуль, позволяющий подделать некоторые строки (могут отличаться) в build.props. В основном меняется fingerprint, номер и версия сборки, а также производитель и модель телефона. Эти строки модифицируются только для выбранных приложений, оставаясь неизменными в самой системе.

PIF поможет вернуть BASIC_ и DEVICE_INTEGRITY (проверить можно через PIAC или SPIC, обе есть в плей маркете)

### Что такое TrickyStore? 
TrickyStore (далее TS) - это подобный PIF'у модуль, который подменяет для определенных приложений сертификат безопасности (keybox.xml)

TS Поможет вернуть STRONG_INTEGRITY, если найти валидный (актуальный, действительный) кейбокс.

Google регулярно (раз в 2-3 недели) отзывает или софтбанит слитые в общий доступ кейбоксы, поэтому их стоит регулярно менять.

### Что такое Zygisk Next?
Zygisk Next - это самостоятельная имплементация Zygisk , предоставляющая доступ к Zygote в KSU/KSUN. Необходима для работы зависимых модулей по типу LSPosed.

### Что такое LSPosed?
LSPosed Framework - это Zygisk-модуль, предоставляющий фреймворк для ART хуков и взаимодействия с API XPosed.

К установке рекомендую все те же модули, что использую сам (кроме pixelxpert, если у тебя не google pixel).
### Порядок установки модулей:

1. Первым делом устанавливаем независимые модули (их можно установить без перезагрузок между установкой):
	- Zygisk Next
	- susfs4ksu
	- PIF
	- TS
	- TrickyAddon
2. Перезагружаемся
3. Устанавливаем зависимый от Zygisk LSPosed, перезагружаемся
4. Готово!

### LSPosed модули:
1. Hide My Applist (HMA) (для скрытия списка приложений от программ)
2. BootloaderSpoofer (для скрытия статуса загрузчика)
эти модули достаточно просто установить апк файлом, лспосед сам их распознает.
Необходимо включить их в менеджере лспосед (открывается через уведомление в шторке, можно создать ярлык на рабочем столе)

## Самая душная, но важная часть. Настройка модулей.

#### Настройка KSU Next
Переходим в настройки менеджера
Включаем следующее:
	Umount modules
	Hide kprobe hooks
	Check update (опционально)
Выключаем следующее:
	Use OverlayFS
	Enable WebView debugging
	Enable developer options
#### Zygisk Next
Ничего не трогаем в WebUI.

#### TrickyStore
После установки TrickyAddon в менеджере KSU/N пояявляется WebUI для трикистора. Открываем.
Жмем на три полоски сверху. Жмем там Select all, Set VALID Keybox и жмем синюю кнопку Save снизу.
Выходим.

#### PlayIntegrityFix
В KSU/N жмем на вторую кнопку (с иконкой логов).
Включаем единственную галчку и жмем Fetch pif.json (требует интернет)
Когда видим в output текст "- Done!", выходим.

#### susfs4ksu
Открываем WebUI в KSU/N.
В открывшемся меню жмем CUSTOM SUSFS SETTINGS.
В первом меню включаем все переключатели, кроме HIDE GAPPS
Справа сверху жмем на MAIN MENU
Включаем все галочки, кроме SUSFS LOGS

В строку SPOOF KERNEL VERSION пишем следующее:
`5.10.214-android13`
В следующую строку пишем `Google`
две галочки внизу должны быть включены
жмем **MAKE IT SUS**
перезагружаемся.

#### LSPosed
Открываем менеджер лспосед через шторку
снизу жмем на иконку с пазлом (Модули)
включаем BootloaderSpoofer, выдаем доступ только к System Framework (система Android), назад
включаем HideMyApplist, выдаем доступ только к System Framework (система Android), назад

Снизу жмем на настройки лспосед
в разделе Framework включаем Disable verbose logs
выключаем Enable log watchdog
по желанию создаем ярлык на рабочий стол (Create shortcut)

#### HideMyApplist
Открываем приложение на рабочем столе
сразу заходим в настройки (кнопка снинзу)
проверяем статус Detail log for debugging. Этот переключатель должен быть выключен
возвращаемся на главну страницу, заходим в App manage
пишем в поиске приложение, от которого хотим скрыть список приложений (например, Standoff 2)
Включаем все 3 галочки, больше ничего не трогаем
точно так же делаем для программ, проверяющих наличие рута
выходим и перезагружаемся на всякий случай

## Мифы

### 1. PIF и TS помогают скрыть рут от игр
Как я уже писал выше, эти модули помогают только для восстановления уелостности Play. Каждое приложение в плей маркете имеет лимит в ~25.000 проверок за день. Как ты понимаешь, в условный стандофф заходят больше 25 тысяч раз, и игра не может проверить каждого, поэтому бессмысленно ставить эти модули, если хочешь скрыть рут от игр.

## Итог
После всех проделанных действий, имеем девайс со скрытыми рут правами. Этого скрытия будет достаточно для всех приложений на момент выпуска гайда.

Благодарности, вопросы и пожертвования: 
	Telegram: https://fe3rcode.t.me
	Email: mrtssasamga@gmail.com
**Очень прошу тебя не спрашивать очевидные вещи, которые может помочь решить гугл/яндекс/любая нейронка.**
**Перед тем, как задавать вопрос, пожалуйста, хотя бы постарайся найти ответ в интернете. Я могу быть агрессивным, когда мне задают очевидные вопросы.**
